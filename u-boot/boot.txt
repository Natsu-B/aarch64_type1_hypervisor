# Force console to serial (optional; this does not fix load Usage)
setenv stdin serial
setenv stdout serial
setenv stderr serial

setenv autostart yes

# Ensure load address is defined
if test -z "${kernel_addr_r}"; then
    setenv kernel_addr_r 0x40200000
fi
echo "[boot] kernel_addr_r=${kernel_addr_r}"

virtio scan

# NOTE: bootflow found /boot.scr at virtio 0:1, so use 0:1 explicitly here too.
if load virtio 0:1 ${kernel_addr_r} elf-hypervisor.elf; then
    echo "[boot] fileaddr=${fileaddr} filesize=${filesize}"
    echo "[boot] bootelf -p ${kernel_addr_r}"
    md.b ${fileaddr} 0x10
    bootelf -p ${kernel_addr_r} $fdt_addr $kernel_addr_rg
    echo "[boot] bootelf returned rc=$?"
else
    echo "[boot] Unable to read elf-hypervisor.elf"
fi
